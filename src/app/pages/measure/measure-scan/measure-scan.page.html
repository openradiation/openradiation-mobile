<app-header>
    <app-gps-indicator other [positionAccuracy]="positionAccuracy$ | async"></app-gps-indicator>
</app-header>

<ion-content>
    <div class="content" *ngIf="currentMeasure$ | async as currentMeasure">
        <div class="category">
            <ng-template #measureScanNotStarted>
                -
            </ng-template>
            <div class="item">
                <div class="label">
                    Début de la mesure
                </div>
                <div class="value">
                    <ng-container *ngIf="currentMeasure.startTime; else measureScanNotStarted">
                        {{currentMeasure.startTime | date: 'HH:mm:SS'}}
                    </ng-container>
                </div>
            </div>
            <div class="separator"></div>
            <div class="item temperature">
                <div class="label">
                    Température capteur
                </div>
                <div class="value">
                    <ng-container *ngIf="currentMeasure.steps && currentMeasure.steps.length > 0; else measureScanNotStarted">
                        {{currentMeasure.steps[currentMeasure.steps.length - 1].temperature}}
                    </ng-container>
                </div>
                <div class="icon">
                    <img src="assets/img/icon-temp.png">
                </div>
            </div>
        </div>
        <div class="accuracy">
            <div class="label">
                FIABILITÉ
            </div>
            <div class="accuracy-indicator">
                <div class="accuracy-indicator-bar" [ngStyle]="{'width.%': hitsAccuracyWidth}"
                     [ngClass]="hitsAccuracy">
                </div>
            </div>
        </div>
        <div class="category">
            <div class="item">
                <div class="label">
                    Nb coups
                </div>
                <div class="value">
                    <ng-container *ngIf="currentMeasure.startTime; else measureScanNotStarted">
                        {{currentMeasure.hitsNumber}}
                    </ng-container>
                </div>
            </div>
            <div class="separator"></div>
            <div class="item">
                <div class="label">
                    Coups/min
                </div>
                <div class="value">
                    <ng-container *ngIf="currentMeasure.endTime && currentMeasure.startTime && currentMeasure.endTime > currentMeasure.startTime; else measureScanNotStarted">
                        {{(currentMeasure.hitsNumber / (currentMeasure.endTime - currentMeasure.startTime)) * 1000 * 60 |
                        number: '1.2-2'}}
                    </ng-container>
                </div>
            </div>
            <div class="item duration">
                <div class="label">
                    Durée
                </div>
                <div class="value">
                    <ng-container *ngIf="currentMeasure.endTime && currentMeasure.startTime; else measureScanNotStarted">
                        {{(currentMeasure.endTime - currentMeasure.startTime) | duration}}
                    </ng-container>
                </div>
                <div class="icon">
                    <img src="assets/img/icon-duration.png">
                </div>
            </div>
        </div>
        <div class="radiation">
            <ng-container *ngIf="currentMeasure.hitsNumber <= hitsAccuracyThreshold.good; else hitsAccuracyMedium">
                <div class="start">
                    {{currentMeasure.startTime ? 'Mesure en cours' : 'Initialisation'}}
                </div>
            </ng-container>
            <ng-template #hitsAccuracyMedium>
                <div class="label">
                    DÉBIT DE DOSE
                </div>
                <div class="value">
                    {{currentMeasure.value}}
                </div>
                <div class="unit">
                    μSvh
                </div>
            </ng-template>
            <div class="background">
                <img src="assets/img/bg-radiation.png">
                <img src="assets/img/bg-radiation.png">
            </div>
        </div>
        <app-round-button [disabled]="currentMeasure.hitsNumber <= hitsAccuracyThreshold.accurate"
                          [src]="currentMeasure.hitsNumber >= hitsAccuracyThreshold.accurate ? 'assets/img/button-on.png' : 'assets/img/button-off.png'"
                          (click)="stopScan()">
            FIN
        </app-round-button>
    </div>
</ion-content>
