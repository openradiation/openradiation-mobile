<ng-container *ngIf="measureReportForm">
    <ng-container *ngIf="currentMeasure$ | async as currentMeasure">
        <app-header>
        </app-header>

        <ion-content>
            <div class="content">
                <form [formGroup]="measureReportForm" ngxsForm="measures.measureReport">
                    <div class="position">
                        <ion-list>
                            <ion-item class="custom-disabled">
                                <ion-label>{{'MEASURES.START_LATITUDE' | translate}}</ion-label>
                                <ion-input formControlName="latitude" required type="number"></ion-input>
                            </ion-item>
                            <ion-item class="custom-disabled">
                                <ion-label>{{'MEASURES.START_LONGITUDE' | translate}}</ion-label>
                                <ion-input formControlName="longitude" required type="number"></ion-input>
                            </ion-item>
                        </ion-list>
                        <app-gps-indicator *ngIf="reportScan" [accuracy]="currentMeasure.accuracy" [compact]="true"></app-gps-indicator>
                    </div>
                    <div class="separator"></div>
                    <div class="position">
                        <ion-list>
                            <ion-item class="custom-disabled">
                                <ion-label>{{'MEASURES.END_LATITUDE' | translate}}</ion-label>
                                <ion-input formControlName="endLatitude" required type="number"></ion-input>
                            </ion-item>
                            <ion-item class="custom-disabled">
                                <ion-label>{{'MEASURES.END_LONGITUDE' | translate}}</ion-label>
                                <ion-input formControlName="endLongitude" required type="number"></ion-input>
                            </ion-item>
                        </ion-list>
                        <app-gps-indicator *ngIf="reportScan" [accuracy]="currentMeasure.endAccuracy" [compact]="true"></app-gps-indicator>
                    </div>
                    <div class="separator"></div>
                    <ion-list>
                        <ion-item class="custom-disabled">
                            <ion-label>{{'GENERAL.DATE' | translate}}</ion-label>
                            <ion-datetime display-format="DD/MM/YYYY" formControlName="date" required [cancelText]="'GENERAL.CANCEL' | translate"
                                          [doneText]="'GENERAL.SUBMIT' | translate"></ion-datetime>
                        </ion-item>
                        <ion-item class="custom-disabled">
                            <ion-label>{{'MEASURES.MEASURE_START' | translate}}</ion-label>
                            <ion-datetime display-format="HH:mm:ss" formControlName="startTime" required
                                          [cancelText]="'GENERAL.CANCEL' | translate" [doneText]="'GENERAL.SUBMIT' | translate"></ion-datetime>
                        </ion-item>
                    </ion-list>
                    <div class="measure">
                        <ion-list>
                            <ion-item [ngClass]="{'custom-disabled': reportScan}">
                                <ion-label position="fixed">{{'MEASURES.DURATION' | translate}}</ion-label>
                                <ion-datetime display-format="mm:ss" formControlName="duration" [cancelText]="'GENERAL.CANCEL' | translate"
                                              [doneText]="'GENERAL.SUBMIT' | translate" placeholder="00:00"></ion-datetime>
                            </ion-item>
                            <ion-item class="has-suffix long-label" [ngClass]="{'custom-disabled': reportScan}">
                                <ion-label position="fixed">{{'MEASURES.TEMPERATURE_AVERAGE' | translate}}</ion-label>
                                <ion-input formControlName="temperature" type="number" placeholder="0"></ion-input><span class="unit">Â°C</span>
                            </ion-item>
                            <ion-item [ngClass]="{'custom-disabled': reportScan}">
                                <ion-label position="fixed">{{'MEASURES.HITS_NUMBER' | translate}}</ion-label>
                                <ion-input formControlName="hitsNumber" type="number" placeholder="0"></ion-input>
                            </ion-item>
                            <ion-item class="has-suffix" [ngClass]="{'custom-disabled': reportScan}">
                                <ion-label position="fixed">{{'MEASURES.TITLE' | translate}}</ion-label>
                                <ion-input formControlName="value" required type="number" placeholder="0.000"></ion-input><span class="unit">{{'MEASURES.DOSE_RATE_UNIT' | translate}}</span>
                            </ion-item>
                        </ion-list>
                    </div>
                    <div class="environment">
                        <app-select-icon [options]="measurementEnvironmentOptions" formControlName="measurementEnvironment" [title]="'MEASURES.ENVIRONMENT.TITLE' | translate">
                        </app-select-icon>
                    </div>
                    <div class="options">
                        <app-select-icon [options]="measurementHeightOptions" formControlName="measurementHeight" [title]="'MEASURES.SENSOR_POSITION.TITLE' | translate">
                        </app-select-icon>
                        <app-select-icon [options]="rainOptions" formControlName="rain" [title]="'MEASURES.WEATHER.TITLE' | translate">
                        </app-select-icon>
                    </div>
                    <ng-container *ngIf="login$ | async">
                        <div class="separator"></div>
                        <ion-list>
                            <ion-item class="description">
                                <ion-textarea formControlName="description" [placeholder]="'MEASURES.DESCRIPTION' | translate" rows="5"></ion-textarea>
                            </ion-item>
                        </ion-list>
                        <div class="tags">
                            <app-tag-list formControlName="tags" [title]="'MEASURES.TAG_LIST' | translate"></app-tag-list>
                        </div>
                    </ng-container>
                </form>
                <div class="bottom-buttons">
                    <app-round-button [disabled]="!measureReportForm.valid"
                                      [src]="measureReportForm.valid ? 'assets/img/button-on.png' : 'assets/img/button-off.png'"
                                      (click)="stopReport()">
                        {{'GENERAL.OK' | translate}}
                    </app-round-button>
                    <div class="side-buttons">
                        <ion-button fill="clear" class="flat-button cancel" (click)="cancelMeasure()">{{'GENERAL.CANCEL' | translate}}</ion-button>
                        <ion-button *ngIf="!currentMeasure.manualReporting && currentMeasure.steps && expertMode$ | async" fill="clear" class="flat-button expert" (click)="showMeasureSteps()">{{'MEASURES.EXPERT' | translate}}</ion-button>
                    </div>
                </div>
            </div>
        </ion-content>
    </ng-container>
</ng-container>